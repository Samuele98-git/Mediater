<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Episodes</title>
    <style>
        body { margin: 0; background: #141414; color: #fff; font-family: sans-serif; }
        
        .header { padding: 40px; background: linear-gradient(to bottom, #222, #141414); border-bottom: 1px solid #333; }
        .back-btn { color: #aaa; text-decoration: none; font-weight: bold; font-size: 0.9rem; }
        h1 { font-size: 3rem; margin: 10px 0; }
        
        .list-container { max-width: 800px; margin: 0 auto; padding: 40px 20px; }
        .episode { 
            display: flex; gap: 20px; padding: 15px; border-bottom: 1px solid #333; 
            cursor: pointer; transition: background 0.2s; align-items: center; 
        }
        .episode:hover { background: #1f1f1f; }
        
        .thumb { width: 140px; aspect-ratio: 16/9; background: #000; border-radius: 4px; overflow: hidden; position: relative; }
        .thumb img, .thumb video { width: 100%; height: 100%; object-fit: cover; }
        
        .play-icon { 
            position: absolute; top:50%; left:50%; transform: translate(-50%, -50%); 
            font-size: 2rem; opacity: 0; transition: 0.2s; text-shadow: 0 2px 4px black;
        }
        .episode:hover .play-icon { opacity: 1; }

        .meta { flex: 1; }
        .ep-title { font-weight: bold; font-size: 1.1rem; margin-bottom: 5px; }
        .ep-num { color: #777; font-size: 0.9rem; font-weight: bold; }
    </style>
</head>
<body>

    <div class="header">
        <a href="index.html" class="back-btn">← Back to Library</a>
        <h1 id="plTitle">Loading...</h1>
        <div style="color:#777" id="plCount">0 Episodes</div>
    </div>

    <div class="list-container" id="list"></div>

    <script>
        const p = new URLSearchParams(location.search);
        const id = p.get('id');

        fetch('/api/data').then(r => r.json()).then(data => {
            const pl = data.playlists[id];
            if(!pl) return location.href = 'index.html';

            document.getElementById('plTitle').textContent = pl.name;
            document.getElementById('plCount').textContent = `${pl.videos.length} Videos`;

            const list = document.getElementById('list');
            
            pl.videos.forEach((vid, idx) => {
                const el = document.createElement('div');
                el.className = 'episode';
                el.onclick = () => location.href = `viewer.html?pl=${id}&vid=${idx}`;

                const isVid = vid.match(/\.(mp4|mkv)$/i);
                const media = isVid 
                    ? `<video src="/stream/${vid}#t=10.0" muted preload="metadata"></video>` 
                    : `<img src="/stream/${vid}">`;

                el.innerHTML = `
                    <div class="ep-num">${idx + 1}</div>
                    <div class="thumb">
                        ${media}
                        <div class="play-icon">▶</div>
                    </div>
                    <div class="meta">
                        <div class="ep-title">${vid}</div>
                    </div>
                `;
                list.appendChild(el);
            });
        });
    </script>
</body>
</html>